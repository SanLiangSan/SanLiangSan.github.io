<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  
  
    <meta name="description" content="ios开发，objc底层，移动开发，apple">
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>
    IOS-大话多线程 |
    
    sanliangsan的博客</title>
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<script src="/js/pace.min.js"></script>

<meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="sanliangsan的博客" type="application/atom+xml">
</head>

<body>
<main class="content">
  <section class="outer">
  <article id="post-IOS-大话多线程" class="article article-type-post" itemscope itemprop="blogPost" data-scroll-reveal>

    <div class="article-inner">
        
            <header class="article-header">
                
  
    <h1 class="article-title" itemprop="name">
      IOS-大话多线程
    </h1>
  
  




            </header>
            

                
                    <div class="article-meta">
                        <a href="/2020/03/03/IOS-%E5%A4%A7%E8%AF%9D%E5%A4%9A%E7%BA%BF%E7%A8%8B/" class="article-date">
  <time datetime="2020-03-03T13:54:45.000Z" itemprop="datePublished">2020-03-03</time>
</a>
                            
                    </div>
                    

                        
                            
    <div class="tocbot"></div>





                                

                                    <div class="article-entry" itemprop="articleBody">
                                        


                                            
  <div class="article-gallery">
    <div class="article-gallery-photos">
      
        
          <img src="https://user-gold-cdn.xitu.io/2020/2/26/17081714bba3834a" itemprop="image">
        
      
    </div>
  </div>


                                                
                                                                    <blockquote>
<p><strong>时间:</strong>  2月26日10点</p>
<p><strong>地点:</strong>  商场</p>
<p><strong>背景:</strong>  隔壁空地上的商场终于建成了，大大小小的商店纷纷入驻，大A发现了商机，想开一家奶茶店，话不多说，交钱干。<a id="more"></a></p>
</blockquote>
<img src="https://user-gold-cdn.xitu.io/2020/2/26/17081f49a38837cd?w=250&amp;h=331&amp;f=jpeg&amp;s=12667" style="zoom:75%;" />

<h2 id="开店-进程"><a href="#开店-进程" class="headerlink" title="开店 = 进程"></a>开店 = 进程</h2><hr>
<p>大A是个踏实肯干的人，开店之初啊，也没想那么多，就想踏踏实实挣点小钱，于是乎把自己的这些想法告诉了设计师，设计师一想，好办：</p>
<ul>
<li><strong>1</strong>间内部操作室和一些调配机器</li>
<li><strong>1</strong>台收银机</li>
<li><strong>1</strong>个收银员+<strong>3</strong>名奶茶调配员</li>
</ul>
<p>齐活，说干就干，不到一个月店面就装修好了，于是乎按照设计师的规划招了4个小姐姐。2020年2月26日，随着一顿鞭炮声大A的奶茶店终于开张了，陆陆续续来了很多顾客…</p>
<blockquote>
<p>我们把商场当做一个系统，那么我们的奶茶店就是一个进程，当然我们的商场还有 H&amp;M啊、 优衣库啊（你懂的！），这些店之间互不干扰，各自开门各自做生意，互不影响…</p>
</blockquote>
<p>开业之初效果:(纯手画，如有不适还请谅解)</p>
<img src="https://user-gold-cdn.xitu.io/2020/2/26/17081997332bb565?w=1430&amp;h=792&amp;f=png&amp;s=497541" alt style="border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;">

<p>这个店（<strong><code>进程</code></strong>）就这样红红火火开起来了…</p>
<blockquote>
<p>系统（System）：商场 </p>
<p>进程（Process）：奶茶店 </p>
<p>线程（Thread）：员工的日常工作 进程是系统中正在运行的一个应用程序，每个进程之间是独立的 （你卖你的奶茶，我卖我的衣服，YES！）</p>
</blockquote>
<h2 id="员工日常工作-线程"><a href="#员工日常工作-线程" class="headerlink" title="员工日常工作 = 线程"></a>员工日常工作 = 线程</h2><p>奶茶店每天都有很多活：</p>
<ul>
<li>进货，分装原料</li>
<li>派单收银</li>
<li>奶茶调配</li>
</ul>
<p>每天我们奶茶店都要开门，只有开门了员工才能进来，才能干活，这是核心门槛<code>（主线程）</code>，所有员工干活才让奶茶店运营起来<code>（线程是进程的基本执行单元）</code>。</p>
<blockquote>
<p>线程（thread）：进程的基本执行单元，一个进程的所有任务都在线程中执行， 进程要想执行任务必须要有线程，程序会默认开启一条线程，这条线程叫 主线程</p>
</blockquote>
<h2 id="扩张-开辟新线程"><a href="#扩张-开辟新线程" class="headerlink" title="扩张 = 开辟新线程"></a>扩张 = 开辟新线程</h2><p>大A还是很踏实肯干的，每天卖命的吆喝，生意也是越来越好，这一天天的，人都排到马路对面了… 期间不断的有人跟大A说：老板啊，多招点人撒，搞两个收银的，排两个队，这大热天的我们等的也是很难受啊，有的人等不了就去别家买了，有钱不赚你是不是傻…</p>
<p>大A一想，也是啊，那么就试试，又找了设计师，这次相对比较简单，就是加台收银机嘛，你再额外招个小姐姐就好了，于是乎店门关了两周，终于算是装修好了.</p>
<img src="https://user-gold-cdn.xitu.io/2020/2/26/17081af1e6507df4?w=1704&amp;h=870&amp;f=png&amp;s=780316" alt style="border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;">

<p>艾玛果然好多了，至少现在顾客都能进屋吹空调了，哈哈，唯独就多招了一个收银小姐姐而已，这买卖划算啊。</p>
<p>不过随着时间的推移，店里也慢慢出现了新的问题…</p>
<h3 id="同时派单问题"><a href="#同时派单问题" class="headerlink" title="同时派单问题"></a>同时派单问题</h3><p>由于每天的原料有限，而且不同的品种的奶茶数量也是有限的，经常小B刚派了一杯🍑🍑🍑口味的，小C也派了一杯🍑🍑🍑口味的，后台一看，MMP。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/2/26/17081f5cb5f2f035?w=300&h=244&f=jpeg&s=14374" alt=""></p>
<p>于是乎，后台就给两位小姐姐提了个<code>idea</code>，你们卖奶茶的时候提前问一下<strong><code>加锁</code></strong>我这边还能做几杯，能做就走单，不能就告知客户，哦了，屌屌的。</p>
<h3 id="圆桌区域变小"><a href="#圆桌区域变小" class="headerlink" title="圆桌区域变小"></a>圆桌区域变小</h3><p>但是有的顾客又提问题了，现在倒是好排队了，但是买了也没地方坐了，原来新的队列占了原来圆桌的区域，导致圆桌变少了，没办法嘛，商场就给我分配这么大的空间，空间有限呀，只能少两张桌子了，也是为了大家更快的喝上奶茶嘛，坐哪重要吗？哈哈！</p>
<img src="https://user-gold-cdn.xitu.io/2020/2/26/17081f63c8f5024e?w=364&amp;h=329&amp;f=jpeg&amp;s=16872" style="zoom:75%;" />

<h3 id="员工很累"><a href="#员工很累" class="headerlink" title="员工很累"></a>员工很累</h3><p>开始几天搞促销，大伙热热烈烈的，几天之后小姐姐B就开始抱怨了，现在两个收银员一起派单，还是我们三个人来配料。真的是…</p>
<img src="https://user-gold-cdn.xitu.io/2020/2/26/17081f6cecd0ad25?w=360&amp;h=294&amp;f=jpeg&amp;s=20499" style="zoom:75%;" />

<h3 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h3><p>有一天后台调配师小C和收银小B闹矛盾了，讲道理是不可能讲道理了。</p>
<img src="https://user-gold-cdn.xitu.io/2020/2/26/17081d93c973aece?w=1376&amp;h=952&amp;f=png&amp;s=562409" alt style="border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 65%; height: 80%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;">

<p>老板一听，你俩玩起<code>死锁</code>来了，我这店还开个锤子哦~</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>通过上面种种，我们分析多线程的优缺点得出：</p>
<div class="output_wrapper" id="output_wrapper_id" style="font-size: 16px; color: rgb(62, 62, 62); line-height: 1.6; word-spacing: 0px; letter-spacing: 0px; font-family: 'Helvetica Neue', Helvetica, 'Hiragino Sans GB', 'Microsoft YaHei', Arial, sans-serif;"><pre style="font-size: inherit; color: inherit; line-height: inherit; margin: 0px; padding: 0px;"><code class="hljs diff" style="overflow-wrap: break-word; margin: 0px 2px; line-height: 15px; font-size: 11px; font-weight: normal; word-spacing: -3px; letter-spacing: 0px; font-family: Consolas, Inconsolata, Courier, monospace; border-radius: 0px; color: rgb(169, 183, 198); background: rgb(40, 43, 46); overflow-x: auto; padding: 0.5em; white-space: pre !important; word-wrap: normal !important; word-break: normal !important; overflow: auto !important; display: -webkit-box !important;">多线程优点<br><span class="hljs-deletion" style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; color: rgb(204, 120, 50); word-wrap: inherit !important; word-break: inherit !important;">-&nbsp;开辟线程能提高程序执行效率（派单更快了）</span><br><br><span class="hljs-deletion" style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; color: rgb(204, 120, 50); word-wrap: inherit !important; word-break: inherit !important;">-&nbsp;能适当提高资源利用率CPU，内存（后台都可以忙活起来）</span><br><br><span class="hljs-deletion" style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; color: rgb(204, 120, 50); word-wrap: inherit !important; word-break: inherit !important;">-&nbsp;线程上的任务执行完后，线程会自动销毁（某一队没人了，收银员小姐姐就开始刷抖音了）</span><br><br>多线程缺点<br><br><span class="hljs-deletion" style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; color: rgb(204, 120, 50); word-wrap: inherit !important; word-break: inherit !important;">-&nbsp;开辟线程需要占用一定的内存空间（圆桌区域变小了）</span><br><br><span class="hljs-deletion" style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; color: rgb(204, 120, 50); word-wrap: inherit !important; word-break: inherit !important;">-&nbsp;程序更加复杂，线程间通讯，多线程数据共享（同时派单问题，加锁问题）</span><br><br><span class="hljs-deletion" style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; color: rgb(204, 120, 50); word-wrap: inherit !important; word-break: inherit !important;">-&nbsp;开启大量线程，会占用大量内存空间，降低程序性能（小姐姐表示好累）</span><br><br><span class="hljs-deletion" style="font-size: inherit; line-height: inherit; margin: 0px; padding: 0px; color: rgb(204, 120, 50); word-wrap: inherit !important; word-break: inherit !important;">-&nbsp;线程越多CPU在线程上的开销越大（小姐姐不够用了，需要更多的小姐姐来配合）</span><br></code></pre></div>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>至此我们关于进程和线程的故事讲的差不多了，你弄明白了吗，下面我们补充一些其他的知识点。</p>
<h3 id="线程生命周期"><a href="#线程生命周期" class="headerlink" title="线程生命周期"></a>线程生命周期</h3><ul>
<li>新建</li>
<li>就绪</li>
<li>运行</li>
<li>阻塞</li>
<li>死亡</li>
</ul>
<figure data-tool="mdnice编辑器" style="margin: 0; margin-top: 10px; margin-bottom: 10px;"><img src="https://user-gold-cdn.xitu.io/2020/2/26/17081ddc8351eb22?w=1310&amp;h=442&amp;f=png&amp;s=292636" alt style="border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;"></figure>

<h3 id="线程创建策略"><a href="#线程创建策略" class="headerlink" title="线程创建策略"></a>线程创建策略</h3><img src="https://user-gold-cdn.xitu.io/2020/2/26/17081df28c38a19f?w=1434&amp;h=650&amp;f=png&amp;s=430511" alt style="border-radius: 0px 0px 5px 5px; display: block; margin: 20px auto; width: 85%; height: 100%; object-fit: contain; box-shadow: #84A1A8 0px 10px 15px;">

<h3 id="线程和Runloop的关系"><a href="#线程和Runloop的关系" class="headerlink" title="线程和Runloop的关系"></a>线程和Runloop的关系</h3><ol>
<li><code>runloop</code>与线程是一一对应的，一个<code>runloop</code>对应一个核心线程。</li>
<li><code>runoop</code>是用来管理线程的，当线程的<code>runloop</code>被开启后，线程会在执行任务完毕后进入休眠状态，当有了新任务的时候就会被唤醒去执行任务。</li>
<li><code>runloop</code>在第一次获取时被创建，在线程结束时被销毁。</li>
<li>对于主线程来说，<code>runloop</code>在程序一启动就默认创建好了。</li>
<li>对于子线程来说，<code>runloop</code>是懒加载的，只有当我们使用时才创建，所以子线程在使用定时器的时候要确保子线程的<code>runloop</code>被创建，不然定时器不会回调。</li>
</ol>
<p>后面我会针对<code>GCD</code>以及各种<code>锁</code>来详述多线程的原理和实线，敬请期待，写的不好，希望多多赐教和点评，谢谢。</p>

                                                                        
                                    </div>
                                    <footer class="article-footer">
                                        <a data-url="http://yoursite.com/2020/03/03/IOS-%E5%A4%A7%E8%AF%9D%E5%A4%9A%E7%BA%BF%E7%A8%8B/" data-id="ck7c25ils0007i93fayam00gm" class="article-share-link">
                                            分享
                                        </a>
                                        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/IOS/" rel="tag">IOS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/objective-c/" rel="tag">objective-c</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" rel="tag">多线程</a></li></ul>

                                    </footer>

    </div>

    
        
  <nav class="article-nav">
    
      <a href="/2020/03/03/dispatch-source-%E8%87%AA%E5%AE%9A%E4%B9%89timer/" class="article-nav-link">
        <strong class="article-nav-caption">前一篇</strong>
        <div class="article-nav-title">
          
            dispatch_source-自定义timer
          
        </div>
      </a>
    
    
      <a href="/2020/03/03/IOS-%E8%87%AA%E5%AE%9A%E4%B9%89KVO/" class="article-nav-link">
        <strong class="article-nav-caption">后一篇</strong>
        <div class="article-nav-title">IOS-自定义KVO</div>
      </a>
    
  </nav>


            

                
                    
                        
  <div class="gitalk" id="gitalk-container"></div>
  
<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">

  
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

  
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.min.js"></script>

  <script type="text/javascript">
    var gitalk = new Gitalk({
      clientID: '8d31e847912e72f68e33',
      clientSecret: '76fa3dc57a75b49b32256fd881795d2d982aac43',
      repo: 'gitalk',
      owner: 'SanLiangSan',
      admin: ['SanLiangSan'],
      // id: location.pathname,      // Ensure uniqueness and length less than 50
      id: md5(location.pathname),
      distractionFreeMode: false,  // Facebook-like distraction free mode
      pagerDirection: 'last'
    })

  gitalk.render('gitalk-container')
  </script>

                            

</article>
</section>
  <footer class="footer">
  <div class="outer">
    <div class="float-right">
      <ul class="list-inline">
  
    <li><i class="fe fe-smile-alt"></i> <span id="busuanzi_value_site_uv"></span></li>
  
    <li><i class="fe fe-bookmark"></i> <span id="busuanzi_value_page_pv"></span></li>
  
</ul>
    </div>
    <ul class="list-inline">
      <li>&copy; 2020 sanliangsan的博客</li>
      <li>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></li>
      <li>Theme  <a href="https://github.com/zhwangart/hexo-theme-ocean" target="_blank" rel="noopener">Ocean</a></li>
    </ul>
  </div>
</footer>

</main>
<aside class="sidebar">
  <button class="navbar-toggle"></button>
<nav class="navbar">
  
    <div class="logo">
      <a href="/"><img src="/images/hexo.svg" alt="sanliangsan的博客"></a>
    </div>
  
  <ul class="nav nav-main">
    
      <li class="nav-item">
        <a class="nav-item-link" href="/">首页</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/archives">归档</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/gallery">相册</a>
      </li>
    
      <li class="nav-item">
        <a class="nav-item-link" href="/about">关于</a>
      </li>
    
    <li class="nav-item">
      <a class="nav-item-link nav-item-search" title="搜索">
        <i class="fe fe-search"></i>
        搜索
      </a>
    </li>
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      <div class="totop" id="totop">
  <i class="fe fe-rocket"></i>
</div>
    </li>
    <li class="nav-item">
      
        <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
          <i class="fe fe-feed"></i>
        </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
</aside>

<script src="/js/jquery-2.0.3.min.js"></script>


<script src="/js/jquery.justifiedGallery.min.js"></script>


<script src="/js/lazyload.min.js"></script>


<script src="/js/busuanzi-2.3.pure.min.js"></script>


  
<script src="/fancybox/jquery.fancybox.min.js"></script>




  
<script src="/js/tocbot.min.js"></script>

  <script>
    // Tocbot_v4.7.0  http://tscanlin.github.io/tocbot/
    tocbot.init({
      tocSelector: '.tocbot',
      contentSelector: '.article-entry',
      headingSelector: 'h1, h2, h3, h4, h5, h6',
      hasInnerContainers: true,
      scrollSmooth: true,
      positionFixedSelector: '.tocbot',
      positionFixedClass: 'is-position-fixed',
      fixedSidebarOffset: 'auto',
    });
  </script>



<script src="/js/ocean.js"></script>


</body>
</html>